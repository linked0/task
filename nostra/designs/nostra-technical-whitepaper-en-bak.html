<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nostra Technical Whitepaper - Market Models & Oracle Integration</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a;
            --primary-light: #1e293b;
            --accent: #6366f1;
            --accent-dark: #4f46e5;
            --accent-light: #818cf8;
            --secondary: #06b6d4;
            --secondary-dark: #0891b2;
            --success: #22c55e;
            --success-dark: #16a34a;
            --warning: #f97316;
            --warning-dark: #ea580c;
            --danger: #f43f5e;
            --danger-dark: #e11d48;
            --purple: #a855f7;
            --purple-dark: #9333ea;
            --border: #e2e8f0;
            --border-dark: #cbd5e1;
            --bg: #ffffff;
            --bg-subtle: #f8fafc;
            --bg-muted: #f1f5f9;
            --text: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(180deg, var(--bg-subtle) 0%, var(--bg) 100%);
            color: var(--text);
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        /* Header */
        header {
            text-align: center;
            padding: 3rem 0 4rem;
            margin-bottom: 2rem;
            position: relative;
        }

        header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 160px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--purple), var(--secondary));
            border-radius: 2px;
        }

        h1 {
            font-size: 2.75rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.75rem;
            letter-spacing: -0.025em;
        }

        .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .author-info {
            font-size: 0.875rem;
            margin-top: 1.25rem;
            color: var(--text-muted);
        }

        /* TOC */
        .toc {
            background: var(--bg);
            padding: 2rem 2.5rem;
            margin-bottom: 3rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .toc::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), var(--purple), var(--secondary));
        }

        .toc h2 {
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
        }

        .toc-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
        }

        .toc-section-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
            font-size: 0.9375rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid transparent;
            background-image: linear-gradient(var(--bg), var(--bg)), linear-gradient(90deg, var(--accent), var(--purple));
            background-origin: padding-box, border-box;
            background-clip: padding-box, border-box;
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin-bottom: 0.5rem;
        }

        .toc a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s;
            display: inline-block;
        }

        .toc a:hover {
            color: var(--accent);
            transform: translateX(4px);
            text-decoration: none;
            background: linear-gradient(90deg, var(--accent), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Part Dividers */
        .part-divider {
            margin: 4rem 0 2.5rem;
            padding: 2.5rem 0;
            text-align: center;
            position: relative;
        }

        .part-divider::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-dark), transparent);
        }

        .part-divider h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0;
            display: inline-block;
            background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 50%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .part-divider .part-subtitle {
            display: block;
            font-size: 0.9375rem;
            color: var(--text-muted);
            font-weight: 400;
            margin-top: 0.5rem;
        }

        /* Sections */
        section {
            background: var(--bg);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            transition: box-shadow 0.2s;
        }

        section:hover {
            box-shadow: var(--shadow), 0 0 0 1px rgba(99, 102, 241, 0.05);
        }

        h3 {
            font-size: 1.375rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        h3::before {
            content: "";
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, var(--accent), var(--purple));
            border-radius: 2px;
        }

        h4 {
            font-size: 1.0625rem;
            font-weight: 600;
            color: var(--primary);
            margin: 2rem 0 1rem;
        }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        ul,
        ol {
            margin-bottom: 1rem;
            padding-left: 1.5rem;
            color: var(--text-secondary);
        }

        li {
            margin-bottom: 0.5rem;
        }

        strong {
            color: var(--primary);
            font-weight: 600;
        }

        /* Tables */
        .table-wrapper {
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 8px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th {
            background: linear-gradient(180deg, #eef2ff, #e0e7ff);
            color: var(--accent-dark);
            font-weight: 600;
            text-align: left;
            padding: 0.875rem 1rem;
            border-bottom: 2px solid #c7d2fe;
            font-size: 0.8125rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: var(--bg-subtle);
        }

        /* Code */
        pre {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            line-height: 1.7;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #eef2ff, #e0e7ff);
            color: var(--accent-dark);
            padding: 0.25rem 0.5rem;
            font-size: 0.9rem;
            border-radius: 4px;
            border: 1px solid #c7d2fe;
        }

        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
            border: none;
        }

        .code-comment {
            color: #6ee7b7;
        }

        .code-keyword {
            color: #a5b4fc;
        }

        .code-function {
            color: #c4b5fd;
        }

        .code-value {
            color: #fcd34d;
        }

        .code-string {
            color: #86efac;
        }

        .code-type {
            color: #67e8f9;
        }

        /* Boxes */
        .box {
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-subtle);
            position: relative;
            overflow: hidden;
        }

        .box::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
        }

        .box-highlight::before {
            background: linear-gradient(180deg, var(--accent), var(--purple));
        }

        .box-success::before {
            background: linear-gradient(180deg, var(--success), var(--secondary));
        }

        .box-warning::before {
            background: linear-gradient(180deg, var(--warning), var(--danger));
        }

        .box-danger::before {
            background: linear-gradient(180deg, var(--danger), var(--purple-dark));
        }

        .box-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: block;
            color: var(--primary);
            font-size: 0.9375rem;
        }

        .box p,
        .box ul {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        /* Labels */
        .label {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            font-size: 0.6875rem;
            font-weight: 600;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .label-success {
            background: linear-gradient(135deg, #bbf7d0, #86efac);
            color: #15803d;
            border: 1px solid #86efac;
        }

        .label-danger {
            background: linear-gradient(135deg, #fecdd3, #fda4af);
            color: #be123c;
            border: 1px solid #fda4af;
        }

        .label-warning {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            color: #c2410c;
            border: 1px solid #fdba74;
        }

        .label-primary {
            background: linear-gradient(135deg, #c7d2fe, #a5b4fc);
            color: #4338ca;
            border: 1px solid #a5b4fc;
        }

        .label-secondary {
            background: linear-gradient(135deg, #a5f3fc, #67e8f9);
            color: #0e7490;
            border: 1px solid #67e8f9;
        }

        .label-purple {
            background: linear-gradient(135deg, #e9d5ff, #d8b4fe);
            color: #7e22ce;
            border: 1px solid #d8b4fe;
        }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .card {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            background: var(--bg);
            transition: all 0.2s;
        }

        .card:hover {
            border-color: var(--accent-light);
            box-shadow: var(--shadow), 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .card h4 {
            margin-top: 0;
            margin-bottom: 0.75rem;
        }

        /* Diagram */
        .diagram {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            margin: 1.5rem 0;
            background: linear-gradient(135deg, #faf5ff 0%, #f0f9ff 50%, #f0fdfa 100%);
        }

        .diagram-title {
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 0.9375rem;
            color: var(--primary);
            text-align: center;
        }

        .diagram-content {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
        }

        .token {
            padding: 0.75rem 1rem;
            text-align: center;
            font-size: 0.8125rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg);
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
        }

        .token:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--secondary);
        }

        .token-slot {
            font-size: 0.6875rem;
            color: var(--text-muted);
        }

        .vs-divider {
            text-align: center;
            padding: 1rem 0;
            font-weight: 700;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        /* Architecture */
        .arch-layer {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            margin: 0.5rem 0;
            background: var(--bg);
            transition: all 0.2s;
        }

        .arch-layer:hover {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.08);
        }

        .arch-layer-title {
            font-weight: 600;
            font-size: 0.9375rem;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }

        .arch-layer-content {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            font-size: 1rem;
        }

        .func {
            background: linear-gradient(135deg, #eef2ff, #e0e7ff);
            padding: 0.75rem 1.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            border-radius: 6px;
            border: 1px solid #c7d2fe;
            color: var(--accent-dark);
        }

        .arch-arrow {
            text-align: center;
            padding: 0.25rem 0;
            color: var(--accent);
            font-size: 1.25rem;
        }

        /* Flow */
        .flow-step {
            background: linear-gradient(135deg, var(--bg-subtle), var(--bg-muted));
            padding: 0.75rem 1rem;
            margin: 0.375rem 0;
            font-size: 0.875rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            text-align: center;
            transition: all 0.2s;
        }

        .flow-step:hover {
            border-color: var(--border-dark);
        }

        .flow-step.final {
            background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
            color: white;
            border-color: var(--accent);
            font-weight: 500;
        }

        .flow-arrow {
            text-align: center;
            color: var(--accent);
            font-size: 1rem;
        }

        /* Implementation List */
        .impl-list {
            list-style: none;
            padding: 0;
        }

        .impl-list li {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            margin: 0.5rem 0;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            transition: all 0.2s;
        }

        .impl-list li:hover {
            border-color: var(--border-dark);
            box-shadow: var(--shadow-sm);
        }

        .impl-number {
            background: linear-gradient(135deg, var(--accent), var(--purple));
            color: white;
            width: 1.75rem;
            height: 1.75rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8125rem;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
        }

        .impl-content {
            flex: 1;
        }

        .impl-content strong {
            display: block;
            font-size: 0.9375rem;
        }

        .impl-content small {
            color: var(--text-muted);
            font-size: 0.8125rem;
        }

        .difficulty {
            padding: 0.25rem 0.625rem;
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            border-radius: 4px;
        }

        .difficulty-easy {
            background: linear-gradient(135deg, #bbf7d0, #86efac);
            color: #15803d;
            border: 1px solid #86efac;
        }

        .difficulty-medium {
            background: linear-gradient(135deg, #fed7aa, #fdba74);
            color: #c2410c;
            border: 1px solid #fdba74;
        }

        .difficulty-hard {
            background: linear-gradient(135deg, #fecdd3, #fda4af);
            color: #be123c;
            border: 1px solid #fda4af;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            section {
                padding: 1.5rem;
            }

            .grid-2,
            .grid-3,
            .toc-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 3rem 0 2rem;
            color: var(--text-muted);
            font-size: 0.8125rem;
            margin-top: 2rem;
        }

        footer::before {
            content: "";
            display: block;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-dark));
            border-radius: 2px;
            margin: 0 auto 2rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Nostra Technical Whitepaper</h1>
            <p class="subtitle">Advanced Market Models & Chainlink Oracle Integration</p>
            <p class="author-info">Authored by Jay Lee | December 2025</p>
        </header>

        <nav class="toc">
            <h2>Table of Contents</h2>
            <div class="toc-grid">
                <div>
                    <div class="toc-section-title">Part 1: Market Models</div>
                    <ul>
                        <li><a href="#model-comparison">1.1 Model Comparison Overview</a></li>
                        <li><a href="#grouped-binary">1.2 Grouped Binary Model (Nostra)</a></li>
                        <li><a href="#ctf-multi">1.3 CTF Multi-Outcome Model</a></li>
                        <li><a href="#negrisk">1.4 NegRisk Adapter (Polymarket)</a></li>
                        <li><a href="#negrisk-conversion">1.5 NegRisk Conversion Mechanics</a></li>
                        <li><a href="#negrisk-arch">1.6 NegRisk Architecture</a></li>
                        <li><a href="#implementation-options">1.7 Implementation Options</a></li>
                    </ul>
                </div>
                <div>
                    <div class="toc-section-title">Part 2: Chainlink Integration</div>
                    <ul>
                        <li><a href="#why-chainlink">2.1 Why Chainlink for Resolution</a></li>
                        <li><a href="#long-tail-markets">2.2 Handling Long-tail Markets</a></li>
                        <li><a href="#chainlink-products">2.3 Chainlink Products Overview</a></li>
                        <li><a href="#resolution-arch">2.4 Resolution Architecture</a></li>
                        <li><a href="#smart-contracts">2.5 Smart Contract Integration</a></li>
                        <li><a href="#cost-security">2.6 Cost & Security</a></li>
                        <li><a href="#roadmap">2.7 Implementation Roadmap</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- PART 1: MARKET MODELS -->
        <div class="part-divider">
            <h2>Part 1: Advanced Market Models</h2>
            <span class="part-subtitle">CTF Multi-Outcome vs NegRisk Adapter</span>
        </div>

        <!-- Section 1.1: Model Comparison -->
        <section id="model-comparison">
            <h3>1.1 Market Model Comparison Overview</h3>
            <p>Understanding the three primary market model architectures for prediction markets with multiple outcomes.
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Grouped Binary (Nostra)</th>
                            <th>CTF Multi-Outcome</th>
                            <th>Grouped Binary + NegRisk (Polymarket)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Initial Probability</strong></td>
                            <td>Flexible (50% or 100/N%)</td>
                            <td>Flexible (100/N% or External)</td>
                            <td>Flexible (Market Decided)</td>
                        </tr>
                        <tr>
                            <td><strong>Sum of YES Prices</strong></td>
                            <td><span class="label label-danger">Flexible (Unlinked)</span></td>
                            <td><span class="label label-success">Always = 100%</span></td>
                            <td><span class="label label-success">~100%</span></td>
                        </tr>
                        <tr>
                            <td><strong>Market Linkage</strong></td>
                            <td>Independent</td>
                            <td>Mechanical (Split/Merge)</td>
                            <td>Adapter (NegRisk)</td>
                        </tr>
                        <tr>
                            <td><strong>Stuck Inventory</strong></td>
                            <td><span class="label label-danger">Yes</span></td>
                            <td><span class="label label-success">No</span></td>
                            <td><span class="label label-success">No</span></td>
                        </tr>
                        <tr>
                            <td><strong>conditionId</strong></td>
                            <td>Multiple (Per Outcome)</td>
                            <td>Single (Shared)</td>
                            <td>Multiple + negRiskMarketId</td>
                        </tr>
                        <tr>
                            <td><strong>Position Conversion</strong></td>
                            <td><span class="label label-danger">Not Possible</span></td>
                            <td><span class="label label-success">Via Merge</span></td>
                            <td><span class="label label-success">Via Adapter</span></td>
                        </tr>
                        <tr>
                            <td><strong>Implementation</strong></td>
                            <td><span class="label label-success">Simple</span></td>
                            <td><span class="label label-warning">Complex</span></td>
                            <td><span class="label label-warning">6-10 Weeks</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="box box-highlight">
                <span class="box-title">Key Takeaway</span>
                <ul>
                    <li><strong>Nostra Current:</strong> Grouped Binary - Simple implementation but stuck inventory
                        issues</li>
                    <li><strong>Polymarket:</strong> Grouped Binary + NegRisk - Solves inventory via adapter layer</li>
                    <li><strong>Core Difference:</strong> Market linkage mechanism (None vs Split/Merge vs NegRisk
                        Adapter)</li>
                </ul>
            </div>
        </section>

        <!-- Section 1.2: Grouped Binary Model (Nostra) -->
        <section id="grouped-binary">
            <h3>1.2 Grouped Binary Model (Nostra)</h3>
            <p>The Grouped Binary model is Nostra's current implementation. Each outcome in a multi-outcome question is
                treated as an independent binary market with its own YES/NO tokens.</p>

            <h4>How It Works</h4>
            <div class="diagram">
                <div class="diagram-title">Grouped Binary Architecture</div>
                <p style="text-align: center; margin-bottom: 1rem; font-size: 0.875rem; color: var(--text-muted);">Each
                    outcome = Independent binary market with separate <code>conditionId</code></p>
                <div class="diagram-content">
                    <div class="token"><span class="token-slot">Market 1</span><br><strong>Spain</strong><br>YES / NO
                    </div>
                    <div class="token"><span class="token-slot">Market 2</span><br><strong>France</strong><br>YES / NO
                    </div>
                    <div class="token"><span class="token-slot">Market 3</span><br><strong>Brazil</strong><br>YES / NO
                    </div>
                    <div class="token"><span class="token-slot">Market 4</span><br><strong>Argentina</strong><br>YES /
                        NO</div>
                    <div class="token"><span class="token-slot">Market 5</span><br><strong>England</strong><br>YES / NO
                    </div>
                </div>
            </div>

            <h4>Key Characteristics</h4>
            <div class="grid-2">
                <div class="card">
                    <h4>Advantages</h4>
                    <ul>
                        <li><strong>Simple Implementation:</strong> Each market is independent, easy to create and
                            manage</li>
                        <li><strong>Familiar UX:</strong> Standard YES/NO betting interface</li>
                        <li><strong>Flexible Pricing:</strong> No mechanical constraints on initial prices</li>
                        <li><strong>Easy Resolution:</strong> One winner resolves YES, others resolve NO</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Disadvantages</h4>
                    <ul>
                        <li><strong>No Market Linkage:</strong> Prices don't sum to 100%</li>
                        <li><strong>Stuck Inventory:</strong> Can't convert Spain YES ‚Üí France YES</li>
                        <li><strong>Arbitrage Leakage:</strong> No mechanical arbitrage enforcement</li>
                        <li><strong>Capital Inefficiency:</strong> Must sell + rebuy to switch positions</li>
                    </ul>
                </div>
            </div>

            <h4>The Stuck Inventory Problem</h4>
            <div class="box box-danger">
                <span class="box-title">Example Scenario</span>
                <p>You hold 100 Spain YES tokens at $0.25 each. Spain gets eliminated. Now you want France YES instead:
                </p>
                <ol>
                    <li><strong>Sell Spain YES:</strong> Price crashed to $0.05 ‚Üí You get only $5 (lost $20)</li>
                    <li><strong>Buy France YES:</strong> Price rose to $0.40 ‚Üí You get only 12.5 tokens</li>
                </ol>
                <p style="margin-top: 1rem;"><strong>Result:</strong> Double slippage, significant value loss. Your
                    position is effectively "stuck."</p>
            </div>

            <div class="box box-highlight">
                <span class="box-title">When Grouped Binary Works Well</span>
                <ul>
                    <li>Low volume markets where conversion demand is minimal</li>
                    <li>Markets with few outcomes (2-3)</li>
                    <li>Short duration markets where position changes are rare</li>
                    <li>MVP/early stage products prioritizing simplicity</li>
                </ul>
            </div>
        </section>

        <!-- Section 1.3: CTF Multi-Outcome -->
        <section id="ctf-multi">
            <h3>1.3 CTF Multi-Outcome Model</h3>
            <p>The CTF Multi-Outcome model is the "pure" way to handle multiple mutually exclusive outcomes using the
                Conditional Tokens Framework. Unlike Grouped Binary where each outcome is a separate market, CTF
                Multi-Outcome uses a single condition with multiple outcome slots.</p>

            <h4>Model Structure Comparison</h4>

            <div class="diagram">
                <div class="diagram-title">CTF Multi-Outcome Model ‚Äî Single Condition, Multiple Outcomes</div>
                <p style="text-align: center; margin-bottom: 1rem; font-size: 0.875rem; color: var(--text-muted);">One
                    <code>conditionId</code> shared by all outcomes
                </p>
                <div class="diagram-content">
                    <div class="token"><strong>Spain</strong><br><span class="token-slot">Slot 0</span></div>
                    <div class="token"><strong>France</strong><br><span class="token-slot">Slot 1</span></div>
                    <div class="token"><strong>Brazil</strong><br><span class="token-slot">Slot 2</span></div>
                    <div class="token"><strong>Argentina</strong><br><span class="token-slot">Slot 3</span></div>
                    <div class="token"><strong>England</strong><br><span class="token-slot">Slot 4</span></div>
                </div>
                <pre
                    style="margin-top: 1.5rem;">prepareCondition(oracle, questionId, <span class="code-value">outcomeSlotCount=5</span>)</pre>
            </div>

            <h4>Split and Merge Operations</h4>
            <p>CTF Multi-Outcome enables mechanical split/merge operations that are impossible in Grouped Binary:</p>

            <div class="grid-2">
                <div class="card">
                    <h4>Split: USDC ‚Üí All Tokens</h4>
                    <p><code>$1 USDC</code> ‚Üí 1 Spain + 1 France + 1 Brazil + 1 Argentina + 1 England</p>
                    <p style="font-size: 0.8125rem; color: var(--text-muted);">Exactly ONE token will be worth $1,
                        others $0</p>
                </div>
                <div class="card">
                    <h4>Merge: All Tokens ‚Üí USDC</h4>
                    <p>1 Spain + 1 France + 1 Brazil + 1 Argentina + 1 England ‚Üí <code>$1 USDC</code></p>
                    <p style="font-size: 0.8125rem; color: var(--text-muted);">Guaranteed $1 regardless of outcome</p>
                </div>
            </div>

            <div class="box box-success">
                <span class="box-title">Why Sum Always = 100%</span>
                <p>The split/merge mechanism creates mechanical arbitrage that forces prices to sum to 100%:</p>
                <ul>
                    <li><strong>If sum > 100%:</strong> Arbitrageurs split $1 ‚Üí sell all tokens ‚Üí profit from excess
                    </li>
                    <li><strong>If sum < 100%:</strong> Arbitrageurs buy all tokens cheap ‚Üí merge ‚Üí profit from $1</li>
                </ul>
            </div>
        </section>

        <!-- Section 1.4: NegRisk Adapter -->
        <section id="negrisk">
            <h3>1.4 NegRisk Adapter (Polymarket Approach)</h3>
            <p><strong>NegRisk = Negative Risk</strong> ‚Äî Managing positions through NO tokens. It's an adapter layer
                that links grouped binary markets via NO token equivalence, enabling position conversion.</p>

            <h4>Real-World Example: Polymarket 2026 FIFA World Cup Winner</h4>
            <div class="box box-success">
                <span class="box-title">Live Market Data</span>
                <p>Polymarket's "2026 FIFA World Cup Winner" market demonstrates NegRisk in production:</p>
                <ul>
                    <li><strong>Total Volume:</strong> $11.1M+ traded</li>
                    <li><strong>Total Liquidity:</strong> $2.08M</li>
                    <li><strong>Outcomes:</strong> 48+ countries (Spain, France, England, Brazil, Argentina, etc.)</li>
                    <li><strong>End Date:</strong> July 20, 2026</li>
                </ul>
                <p style="margin-top: 1rem; font-size: 0.8125rem;">
                    <a href="https://polymarket.com/event/2026-fifa-world-cup-winner-595" target="_blank"
                        style="color: var(--accent);">View on Polymarket ‚Üí</a>
                    <span style="margin: 0 0.5rem; color: var(--text-muted);">|</span>
                    <a href="https://gamma-api.polymarket.com/events?slug=2026-fifa-world-cup-winner-595"
                        target="_blank" style="color: var(--secondary);">API Data (JSON) ‚Üí</a>
                </p>
            </div>

            <h4>Technical Structure (from Polymarket API)</h4>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th>
                            <th>Purpose</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>negRiskMarketId</code></td>
                            <td><code style="font-size: 0.7rem;">0xb5c32a9acd39...</code></td>
                            <td>Links all 48+ binary markets together</td>
                        </tr>
                        <tr>
                            <td><code>conditionId</code> (Spain)</td>
                            <td><code style="font-size: 0.7rem;">0x7976b8dbacf9...</code></td>
                            <td>Unique per outcome (each country has its own)</td>
                        </tr>
                        <tr>
                            <td><code>conditionId</code> (Brazil)</td>
                            <td><code style="font-size: 0.7rem;">0x30d55d8124ee...</code></td>
                            <td>Different conditionId, same negRiskMarketId</td>
                        </tr>
                        <tr>
                            <td><code>clobTokenIds</code></td>
                            <td>2 per market</td>
                            <td>YES token ID + NO token ID for orderbook</td>
                        </tr>
                        <tr>
                            <td><code>minTickSize</code></td>
                            <td>0.01</td>
                            <td>Minimum price increment ($0.01)</td>
                        </tr>
                        <tr>
                            <td><code>minOrderSize</code></td>
                            <td>5</td>
                            <td>Minimum order amount</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4>Current Odds Example</h4>
            <div class="diagram">
                <div class="diagram-title">Top Contenders ‚Äî Prices from Polymarket</div>
                <div class="diagram-content">
                    <div class="token"><strong>Spain</strong><br>16¬¢ YES<br><span class="token-slot">$169K vol</span>
                    </div>
                    <div class="token"><strong>France</strong><br>14¬¢ YES<br><span class="token-slot">$142K vol</span>
                    </div>
                    <div class="token"><strong>England</strong><br>13¬¢ YES<br><span class="token-slot">$128K vol</span>
                    </div>
                    <div class="token"><strong>Brazil</strong><br>9¬¢ YES<br><span class="token-slot">$89K vol</span>
                    </div>
                    <div class="token"><strong>Argentina</strong><br>9¬¢ YES<br><span class="token-slot">$85K vol</span>
                    </div>
                </div>
                <p style="text-align: center; margin-top: 1rem; font-size: 0.8125rem; color: var(--text-muted);">
                    Sum ‚âà 61% for top 5 teams. Remaining ~39% distributed across 43+ other countries.
                </p>
            </div>

            <h4>The Problem: Stuck Inventory</h4>
            <div class="box box-danger">
                <span class="box-title">Grouped Binary Limitation</span>
                <p>In Grouped Binary (Nostra's current model), each outcome is independent. If you hold Spain YES and
                    want France YES instead:</p>
                <ol>
                    <li>Sell Spain YES on orderbook (slippage risk)</li>
                    <li>Use USDC to buy France YES (more slippage)</li>
                </ol>
                <p><strong>No direct conversion possible.</strong></p>
            </div>

            <h4>The Key Insight: NO Token Equivalence</h4>
            <p>In a mutually exclusive market (only ONE team can win), all NO tokens have a special property:</p>

            <div class="box box-highlight">
                <span class="box-title">Mathematical Equivalence</span>
                <p><strong>If Spain wins:</strong> Spain NO = $0, but France NO = $1, Brazil NO = $1, etc.</p>
                <p><strong>If France wins:</strong> France NO = $0, but Spain NO = $1, Brazil NO = $1, etc.</p>
                <p style="margin-top: 1rem;"><strong>N NO tokens (one for each team) = $(N-1) guaranteed</strong></p>
            </div>

            <h4>Example: 5 Teams</h4>
            <pre>
<span class="code-comment">// If Spain wins:</span>
Spain NO = <span class="code-value">$0</span>
France NO = <span class="code-value">$1</span>
Brazil NO = <span class="code-value">$1</span>
Argentina NO = <span class="code-value">$1</span>
England NO = <span class="code-value">$1</span>
<span class="code-keyword">Total = $4</span>

<span class="code-comment">// If France wins:</span>
Spain NO = <span class="code-value">$1</span>
France NO = <span class="code-value">$0</span>
Brazil NO = <span class="code-value">$1</span>
Argentina NO = <span class="code-value">$1</span>
England NO = <span class="code-value">$1</span>
<span class="code-keyword">Total = $4</span>

<span class="code-comment">// No matter who wins: Total = $4 (always!)</span>
<span class="code-keyword">5 NO tokens = $4 = $(N-1)</span>
            </pre>
        </section>

        <!-- Section 1.5: NegRisk Conversion -->
        <section id="negrisk-conversion">
            <h3>1.5 NegRisk Conversion Mechanics</h3>
            <p>NegRisk uses the mathematical equivalence to enable position conversion:</p>

            <h4>Conversion Formula: NO ‚Üí YES</h4>
            <div class="box box-highlight">
                <p><strong>You have:</strong> Spain NO + France NO + Brazil NO + Argentina NO (4 tokens)</p>
                <p><strong>You want:</strong> England YES</p>
                <p style="margin-top: 1rem;"><strong>Conversion:</strong><br>
                    4 NO tokens (not England) = $3 guaranteed value = 1 England YES + remaining USDC</p>
                <p style="margin-top: 1rem;"><strong>Result:</strong><br>
                    Burn: Spain NO, France NO, Brazil NO, Argentina NO<br>
                    Receive: 1 England YES + some USDC</p>
            </div>

            <h4>Why This Works</h4>
            <div class="grid-2">
                <div class="card">
                    <h4>Without NegRisk</h4>
                    <p>Spain YES ‚Üí Sell on orderbook ‚Üí USDC ‚Üí Buy France YES</p>
                    <p style="color: #991b1b;"><strong>Problem:</strong> Slippage on both trades, dependent on liquidity
                    </p>
                </div>
                <div class="card">
                    <h4>With NegRisk</h4>
                    <p>Spain YES ‚Üí Convert via adapter ‚Üí France YES</p>
                    <p style="color: #166534;"><strong>Benefit:</strong> Mathematical conversion, no slippage on
                        conversion step</p>
                </div>
            </div>

            <h4>Order Execution: Two Paths to Buy YES</h4>
            <p>When a user wants to buy Spain YES, the system can choose the optimal execution path:</p>

            <div class="grid-2">
                <div class="card">
                    <h4>Path 1: Direct Orderbook</h4>
                    <pre style="margin: 0.75rem 0; font-size: 0.8rem;">
Buy Spain YES directly at 17¬¢ ask

Simple, but limited by
YES-side liquidity</pre>
                </div>
                <div class="card">
                    <h4>Path 2: Mint + Sell NO (NegRisk)</h4>
                    <pre style="margin: 0.75rem 0; font-size: 0.8rem;">
Step 1: $1 USDC ‚Üí Mint Spain YES + NO
Step 2: Sell Spain NO at 83¬¢ bid
Step 3: Keep Spain YES

Net cost: $1.00 - $0.83 = 17¬¢</pre>
                </div>
            </div>

            <h4>When Does Path 2 Win?</h4>
            <p>In efficient markets, both paths yield similar prices. But <strong>slippage differs based on liquidity
                    depth</strong>:</p>

            <div class="diagram">
                <div class="diagram-title">Example: Buy 10,000 Spain YES</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; padding: 1rem;">
                    <div>
                        <p style="font-weight: 600; color: var(--danger); margin-bottom: 0.5rem;">YES Orderbook (thin)
                        </p>
                        <pre
                            style="font-size: 0.8rem; margin: 0; background: #fef2f2; padding: 1rem; border-radius: 6px; border-left: 3px solid var(--danger); color: #b91c1c;">
17¬¢: 2,000 shares
18¬¢: 3,000 shares
19¬¢: 2,500 shares
20¬¢: 5,000 shares
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Avg price: ~18.5¬¢ ‚ùå</pre>
                    </div>
                    <div>
                        <p style="font-weight: 600; color: var(--success); margin-bottom: 0.5rem;">NO Orderbook (deep)
                        </p>
                        <pre
                            style="font-size: 0.8rem; margin: 0; background: #f0fdf4; padding: 1rem; border-radius: 6px; border-left: 3px solid var(--success); color: #15803d;">
83¬¢: 50,000 shares
82¬¢: 30,000 shares
81¬¢: 20,000 shares

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Avg price: ~17.2¬¢ ‚úì</pre>
                    </div>
                </div>
                <p style="text-align: center; margin-top: 0.75rem; font-size: 0.875rem; color: var(--text-muted);">
                    NO tokens often have deeper liquidity ‚Üí NegRisk path gives better execution for large orders
                </p>
            </div>

            <div class="box box-highlight" style="margin-top: 1.5rem;">
                <span class="box-title">Order Router Logic</span>
                <pre style="font-size: 0.8rem; margin: 0.75rem 0;">
<span class="code-keyword">function</span> getBestExecutionPath(outcome, amount):

    <span class="code-comment">// Calculate cost via direct YES purchase</span>
    directCost = simulateOrderbookBuy(outcome.YES, amount)

    <span class="code-comment">// Calculate cost via mint + sell NO</span>
    mintCost = amount * $1.00
    noProceeds = simulateOrderbookSell(outcome.NO, amount)
    negRiskCost = mintCost - noProceeds

    <span class="code-comment">// Return cheaper path</span>
    <span class="code-keyword">return</span> (directCost < negRiskCost) ? <span class="code-value">"orderbook"</span> : <span class="code-value">"negrisk"</span></pre>
                <p style="font-size: 0.8125rem; color: var(--text-muted); margin-top: 0.75rem;">
                    This routing happens automatically ‚Äî users just click "Buy YES" and get best execution.
                </p>
            </div>

            <h4>NegRisk Advantages</h4>
            <div class="grid-2">
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">üíß</span>
                        <h4 style="margin: 0;">Unified Liquidity</h4>
                    </div>
                    <p>All outcomes share liquidity through NO token equivalence. Instead of fragmenting liquidity
                        across 48 separate markets, the NegRisk adapter creates a unified liquidity pool.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">üí∞</span>
                        <h4 style="margin: 0;">Capital Efficiency</h4>
                    </div>
                    <p>Lower collateral requirements through shared backing. Holding N NO tokens only requires $(N-1) in
                        value, enabling more efficient capital deployment for market makers.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">‚ö°</span>
                        <h4 style="margin: 0;">Zero Slippage Conversion</h4>
                    </div>
                    <p>Convert between positions mathematically without orderbook dependency. The conversion rate is
                        deterministic, eliminating slippage on the conversion step itself.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">üìä</span>
                        <h4 style="margin: 0;">Better Price Discovery</h4>
                    </div>
                    <p>Arbitrage opportunities keep prices in sync across all outcomes. If sum of YES prices deviates
                        from 100%, arbitrageurs can profit by converting, maintaining market efficiency.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">üìà</span>
                        <h4 style="margin: 0;">Infinite Scalability</h4>
                    </div>
                    <p>Support 48+ outcomes without fragmenting liquidity. Polymarket's World Cup market demonstrates
                        this with all countries trading against unified liquidity.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">üîì</span>
                        <h4 style="margin: 0;">No Stuck Inventory</h4>
                    </div>
                    <p>Always a mathematical path to exit or convert positions. Users never get stuck with illiquid
                        tokens ‚Äî they can always convert to any other outcome.</p>
                </div>
            </div>

            <div class="box box-success" style="margin-top: 1.5rem;">
                <span class="box-title">Why This Matters for Prediction Markets</span>
                <p>Traditional prediction markets suffer from <strong>liquidity fragmentation</strong> ‚Äî each outcome
                    competes for the same limited capital. NegRisk solves this by recognizing that NO tokens are
                    mathematically linked, creating a "liquidity bridge" between all outcomes.</p>
                <p style="margin-top: 0.75rem;">This is why Polymarket can offer 48+ country outcomes with $2M+ total
                    liquidity, while a Grouped Binary approach would struggle to maintain depth across all outcomes.</p>
            </div>

            <h4>Worked Example: $10,000 Liquidity, 10 Countries</h4>
            <p>Let's trace what happens when traders make $10 purchases sequentially.</p>

            <div class="diagram">
                <div class="diagram-title">Initial Setup</div>
                <pre style="font-size: 0.85rem; margin: 0; padding: 1rem; background: #1e293b; color: #e2e8f0; border-radius: 6px;">
10 Countries: Spain, France, Brazil, Argentina, England,
              Germany, Italy, Portugal, Netherlands, Belgium

Initial price: 10¬¢ YES / 90¬¢ NO each (10% probability)
Market maker: $1,000 per country ‚Üí 1,000 (YES+NO) pairs each</pre>
            </div>

            <h5 style="margin-top: 1.5rem;">Grouped Binary: After 10 Trades (mostly Spain)</h5>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th>YES Left</th>
                            <th>NO Left</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Spain</strong></td>
                            <td style="color: var(--danger);">312</td>
                            <td>1,000</td>
                            <td><span class="label label-danger">688 NO stuck!</span></td>
                        </tr>
                        <tr>
                            <td>France</td>
                            <td>800</td>
                            <td>1,000</td>
                            <td><span class="label label-warning">200 excess NO</span></td>
                        </tr>
                        <tr>
                            <td>Brazil</td>
                            <td>900</td>
                            <td>1,000</td>
                            <td><span class="label label-warning">100 excess NO</span></td>
                        </tr>
                        <tr>
                            <td>Others...</td>
                            <td>1,000</td>
                            <td>1,000</td>
                            <td><span class="label label-success">Balanced</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="box box-danger" style="margin-top: 1rem;">
                <span class="box-title">Problem: Spain Liquidity Crisis</span>
                <pre style="font-size: 0.85rem; margin: 0.5rem 0; padding: 1rem; background: #450a0a; color: #fecaca; border-radius: 6px;">
Trade 11: Buy $10 Spain YES...

Only 312 Spain YES left!
Price jumps: 10¬¢ ‚Üí 15¬¢ ‚Üí 20¬¢ (slippage)
$10 only buys 50 tokens instead of 100

Meanwhile: 688 Spain NO tokens sitting useless üíÄ
Market maker CANNOT move NO to other countries</pre>
            </div>

            <h5 style="margin-top: 1.5rem;">NegRisk: Market Maker Rebalances</h5>
            <div class="box box-highlight">
                <span class="box-title">NegRisk Conversion Magic</span>
                <pre style="font-size: 0.85rem; margin: 0.5rem 0; padding: 1rem; background: #1e1b4b; color: #c7d2fe; border-radius: 6px;">
Take 200 excess NO from each country:
‚Ä¢ 200 Spain NO + 200 France NO + 200 Brazil NO + ...
= 2,000 complete NO sets (one from each country)
= 10 NO tokens √ó 200 sets = $1,800 value (10 NO = $9)

Convert ‚Üí $1,800 USDC returned to market maker!</pre>
                <p style="margin-top: 0.75rem;">Market maker uses $1,800 to mint 500 new Spain (YES+NO) pairs ‚Üí <strong>Spain liquidity restored!</strong></p>
            </div>

            <div class="grid-2" style="margin-top: 1rem;">
                <div class="card" style="border-left: 3px solid var(--danger);">
                    <h4>Grouped Binary Result</h4>
                    <ul style="font-size: 0.875rem;">
                        <li>Spain YES remaining: <strong style="color: var(--danger);">312</strong></li>
                        <li>Slippage: <strong style="color: var(--danger);">HIGH</strong></li>
                        <li>Excess NO: <strong>STUCK</strong></li>
                        <li>Next trader pays: <strong>+50% more</strong></li>
                    </ul>
                </div>
                <div class="card" style="border-left: 3px solid var(--success);">
                    <h4>NegRisk Result</h4>
                    <ul style="font-size: 0.875rem;">
                        <li>Spain YES remaining: <strong style="color: var(--success);">800</strong></li>
                        <li>Slippage: <strong style="color: var(--success);">LOW</strong></li>
                        <li>Excess NO: <strong>CONVERTED</strong></li>
                        <li>Next trader pays: <strong>Normal price</strong></li>
                    </ul>
                </div>
            </div>

            <h4 style="margin-top: 2rem;">Who Does the Rebalancing?</h4>
            <p>The NegRisk adapter is <strong>permissionless</strong> ‚Äî anyone can call the conversion functions. In practice:</p>

            <div class="grid-2">
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">ü§ñ</span>
                        <h4 style="margin: 0;">Arbitrage Bots</h4>
                    </div>
                    <p style="font-size: 0.875rem;">Automated bots monitor price discrepancies. When YES prices sum to ‚â†100%, they profit by converting ‚Äî and rebalance liquidity as a side effect.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">üè¶</span>
                        <h4 style="margin: 0;">Professional Market Makers</h4>
                    </div>
                    <p style="font-size: 0.875rem;">Firms like Wintermute, GSR run sophisticated strategies. They actively rebalance their inventory using NegRisk to maintain tight spreads.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">‚öôÔ∏è</span>
                        <h4 style="margin: 0;">Protocol Automation</h4>
                    </div>
                    <p style="font-size: 0.875rem;">Some protocols run keeper bots that automatically rebalance when inventory skews beyond thresholds ‚Äî funded by trading fees.</p>
                </div>
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <span style="font-size: 1.25rem;">üí°</span>
                        <h4 style="margin: 0;">Smart Traders</h4>
                    </div>
                    <p style="font-size: 0.875rem;">Any user who spots the opportunity can execute conversions. The economic incentive (profit from mispricing) ensures someone always does it.</p>
                </div>
            </div>

            <div class="box box-highlight" style="margin-top: 1.5rem;">
                <span class="box-title">Key Insight: Incentive Alignment</span>
                <p>No single entity needs to be "the market maker." The NegRisk adapter creates <strong>economic incentives</strong> that naturally attract participants to rebalance liquidity. Arbitrageurs profit ‚Üí Liquidity improves ‚Üí Everyone wins.</p>
            </div>

            <h4 style="margin-top: 2rem;">How is Conversion Triggered?</h4>
            <p>NegRisk contracts are <strong>passive</strong> ‚Äî they don't auto-execute. External actors monitor and trigger when profitable.</p>

            <div class="diagram">
                <div class="diagram-title">Trigger Flow: Off-chain Monitoring ‚Üí On-chain Execution</div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem; padding: 1rem;">
                    <div class="flow-step" style="background: var(--bg-subtle);">1. Off-chain Bot watches orderbooks via API/WebSocket</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step" style="background: var(--bg-subtle);">2. Calculates: Sum of YES prices = 103% ‚Üí Profit opportunity!</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step" style="background: var(--bg-subtle);">3. Calls NegRisk contract: <code>convertPosition()</code></div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step final" style="background: linear-gradient(135deg, #dcfce7, #bbf7d0); color: #166534;">4. Bot profits + Liquidity rebalanced (side effect)</div>
                </div>
            </div>

            <h5 style="margin-top: 1.5rem;">Example: Arbitrage Bot Logic</h5>
            <pre style="font-size: 0.8rem; background: #1e293b; color: #e2e8f0; padding: 1.25rem; border-radius: 8px;">
<span class="code-comment">// Off-chain bot (runs continuously, 24/7)</span>
<span class="code-keyword">while</span> (true) {
    <span class="code-comment">// 1. Fetch all YES prices from orderbook</span>
    <span class="code-keyword">const</span> prices = <span class="code-keyword">await</span> getYesPrices(); <span class="code-comment">// [0.16, 0.14, 0.13, ...]</span>
    <span class="code-keyword">const</span> sum = prices.reduce((a, b) => a + b); <span class="code-comment">// 1.03 (103%)</span>

    <span class="code-comment">// 2. Check if profitable after gas costs</span>
    <span class="code-keyword">const</span> profit = sum - <span class="code-value">1.0</span>;  <span class="code-comment">// 0.03 (3%)</span>
    <span class="code-keyword">const</span> gasCost = <span class="code-value">0.005</span>;     <span class="code-comment">// ~$5 in gas</span>

    <span class="code-keyword">if</span> (profit > gasCost) {
        <span class="code-comment">// 3. Execute on-chain conversion</span>
        <span class="code-keyword">await</span> negRiskAdapter.convertPosition(...);
        console.log(<span class="code-value">"Profit captured!"</span>);
    }

    <span class="code-keyword">await</span> sleep(<span class="code-value">100</span>); <span class="code-comment">// Check every 100ms</span>
}</pre>

            <h5 style="margin-top: 1.5rem;">Trigger Mechanisms Comparison</h5>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Actor</th>
                            <th>How They Monitor</th>
                            <th>When They Trigger</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Arbitrage Bots</strong></td>
                            <td>WebSocket price feeds 24/7</td>
                            <td>YES sum ‚â† 100% (instant, ~100ms)</td>
                        </tr>
                        <tr>
                            <td><strong>Market Makers</strong></td>
                            <td>Internal inventory tracking</td>
                            <td>Inventory skew > threshold</td>
                        </tr>
                        <tr>
                            <td><strong>Chainlink Automation</strong></td>
                            <td>On-chain <code>checkUpkeep()</code></td>
                            <td>Configurable conditions met</td>
                        </tr>
                        <tr>
                            <td><strong>MEV Searchers</strong></td>
                            <td>Mempool monitoring</td>
                            <td>Spot profitable txs to frontrun</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="box box-success" style="margin-top: 1.5rem;">
                <span class="box-title">Self-Sustaining System</span>
                <p>The "WHEN" is determined by <strong>profit</strong>, not by the protocol:</p>
                <ul style="margin-top: 0.5rem;">
                    <li><strong>Profit exists?</strong> ‚Üí Someone triggers within milliseconds</li>
                    <li><strong>No profit?</strong> ‚Üí No one triggers (no need to rebalance)</li>
                </ul>
                <p style="margin-top: 0.75rem;">This is why it's self-sustaining ‚Äî the system doesn't need to know when. Economic incentives ensure it happens automatically.</p>
            </div>
        </section>

        <!-- Section 1.6: NegRisk Architecture -->
        <section id="negrisk-arch">
            <h3>1.6 NegRisk Architecture</h3>

            <div class="box box-highlight">
                <span class="box-title">Open Source Reference</span>
                <p>Polymarket's NegRisk implementation is open source and audited by ChainSecurity and OpenZeppelin.</p>
                <p style="margin-top: 0.75rem; font-size: 0.8125rem;">
                    <a href="https://github.com/Polymarket/neg-risk-ctf-adapter" target="_blank"
                        style="color: var(--accent);">GitHub: Polymarket/neg-risk-ctf-adapter ‚Üí</a>
                </p>
                <p style="font-size: 0.8125rem; color: var(--text-muted); margin-top: 0.5rem;">
                    Contains: NegRiskAdapter, NegRiskOperator, NegRiskCtfExchange, WrappedCollateral, Vault, FeeModule
                </p>
            </div>

            <h4>Architecture Layers</h4>
            <div class="arch-layer">
                <div class="arch-layer-title">User Interface</div>
                <div class="arch-layer-content">
                    <div class="func">"Convert my Spain YES to France YES"</div>
                </div>
            </div>

            <div class="arch-arrow">‚Üì</div>

            <div class="arch-layer">
                <div class="arch-layer-title">NegRisk Adapter</div>
                <div class="arch-layer-content">
                    <div class="func">splitPosition()</div>
                    <div class="func">mergePositions()</div>
                    <div class="func">convertPosition()</div>
                </div>
                <p style="text-align: center; margin-top: 0.75rem; font-size: 0.9rem; color: var(--text-muted);">
                    Core: USDC ‚Üî NO tokens ‚Üî YES tokens conversion</p>
            </div>

            <div class="arch-arrow">‚Üì</div>

            <div class="arch-layer">
                <div class="arch-layer-title">Grouped Binary Markets</div>
                <p style="text-align: center; font-size: 0.9rem; color: var(--text-muted);">
                    Spain YES/NO | France YES/NO | Brazil YES/NO | ...<br>
                    All linked by <code>negRiskMarketId</code>
                </p>
            </div>

            <div class="arch-arrow">‚Üì</div>

            <div class="arch-layer">
                <div class="arch-layer-title">Conditional Tokens Framework (CTF)</div>
                <p style="text-align: center; font-size: 0.9rem; color: var(--text-muted);">Base layer for all token
                    operations</p>
            </div>

            <h4>Key Contracts</h4>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Contract</th>
                            <th>Purpose</th>
                            <th>Nostra Has?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>NegRiskAdapter</strong></td>
                            <td>Core conversion logic (NO ‚Üí YES)</td>
                            <td><span class="label label-danger">No</span></td>
                        </tr>
                        <tr>
                            <td><strong>NegRiskOperator</strong></td>
                            <td>Admin functions, oracle integration</td>
                            <td><span class="label label-danger">No</span></td>
                        </tr>
                        <tr>
                            <td><strong>WrappedCollateral</strong></td>
                            <td>Wrapped USDC for atomic operations</td>
                            <td><span class="label label-danger">No</span></td>
                        </tr>
                        <tr>
                            <td>ConditionalTokens (CTF)</td>
                            <td>Base token framework</td>
                            <td><span class="label label-success">Yes</span></td>
                        </tr>
                        <tr>
                            <td>MarketFactory</td>
                            <td>Create binary markets</td>
                            <td><span class="label label-success">Yes</span></td>
                        </tr>
                        <tr>
                            <td>CTFExchange</td>
                            <td>Order book trading</td>
                            <td><span class="label label-success">Yes</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 1.7: Implementation Options -->
        <section id="implementation-options">
            <h3>1.7 Implementation Options</h3>

            <h4>What Nostra Needs to Implement NegRisk</h4>
            <ul class="impl-list">
                <li>
                    <span class="impl-number">1</span>
                    <div class="impl-content">
                        <strong>WrappedCollateral.sol</strong>
                        <small>ERC20 wrapper around USDC for internal accounting</small>
                    </div>
                    <span class="difficulty difficulty-easy">Easy</span>
                </li>
                <li>
                    <span class="impl-number">2</span>
                    <div class="impl-content">
                        <strong>NegRiskAdapter.sol</strong>
                        <small>Core conversion logic: splitPosition, mergePositions, convertPosition</small>
                    </div>
                    <span class="difficulty difficulty-hard">Hard</span>
                </li>
                <li>
                    <span class="impl-number">3</span>
                    <div class="impl-content">
                        <strong>NegRiskOperator.sol</strong>
                        <small>Market group management, links binary markets together</small>
                    </div>
                    <span class="difficulty difficulty-medium">Medium</span>
                </li>
                <li>
                    <span class="impl-number">4</span>
                    <div class="impl-content">
                        <strong>Database: negRiskMarketId field</strong>
                        <small>Link markets in the same group</small>
                    </div>
                    <span class="difficulty difficulty-easy">Easy</span>
                </li>
                <li>
                    <span class="impl-number">5</span>
                    <div class="impl-content">
                        <strong>API: /api/negrisk/convert endpoint</strong>
                        <small>Handle conversion requests from frontend</small>
                    </div>
                    <span class="difficulty difficulty-medium">Medium</span>
                </li>
                <li>
                    <span class="impl-number">6</span>
                    <div class="impl-content">
                        <strong>Frontend: Convert Position UI</strong>
                        <small>Button to convert between outcomes in the same group</small>
                    </div>
                    <span class="difficulty difficulty-medium">Medium</span>
                </li>
            </ul>

            <h4>Estimated Effort</h4>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Time</th>
                            <th>Complexity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Smart Contracts (1-3)</td>
                            <td>2-3 weeks</td>
                            <td>High (security critical)</td>
                        </tr>
                        <tr>
                            <td>Backend API (4-5)</td>
                            <td>3-5 days</td>
                            <td>Medium</td>
                        </tr>
                        <tr>
                            <td>Frontend UI (6)</td>
                            <td>3-5 days</td>
                            <td>Medium</td>
                        </tr>
                        <tr>
                            <td>Testing & Audit</td>
                            <td>2-4 weeks</td>
                            <td>Critical</td>
                        </tr>
                        <tr>
                            <td><strong>Total</strong></td>
                            <td><strong>6-10 weeks</strong></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="box box-warning">
                <span class="box-title">Alternative: Arbitrage Bots</span>
                <p>Before implementing NegRisk, consider if you really need it. Current arbitrage bots can provide
                    economic position balancing with much simpler implementation.</p>
                <p><strong>When to implement NegRisk?</strong></p>
                <ul>
                    <li>High volume when conversion demand justifies complexity</li>
                    <li>User complaints about stuck inventory</li>
                    <li>Competitive pressure for Polymarket-level features</li>
                </ul>
            </div>
        </section>

        <!-- PART 2: CHAINLINK INTEGRATION -->
        <div class="part-divider">
            <h2>Part 2: Chainlink Oracle Integration</h2>
            <span class="part-subtitle">Decentralized Market Resolution</span>
        </div>

        <!-- Section 2.1: Why Chainlink -->
        <section id="why-chainlink">
            <h3>2.1 Why Chainlink for Market Resolution</h3>

            <h4>Current State: Manual Resolution</h4>
            <div class="box box-danger">
                <span class="box-title">Problems with Manual Resolution</span>
                <ul>
                    <li><strong>Centralized trust:</strong> Admin can manipulate outcomes</li>
                    <li><strong>No verifiable source:</strong> Users must trust the platform</li>
                    <li><strong>Human error risk:</strong> Manual process prone to mistakes</li>
                </ul>
            </div>

            <h4>Chainlink Solution</h4>
            <div class="box box-success">
                <span class="box-title">Benefits of Chainlink Resolution</span>
                <ul>
                    <li><strong>Decentralized oracle network:</strong> Multiple nodes verify data</li>
                    <li><strong>Verifiable data sources:</strong> Cryptographic proofs of authenticity</li>
                    <li><strong>Trustless automation:</strong> No human intervention needed</li>
                    <li><strong>Industry standard:</strong> Proven security track record</li>
                </ul>
            </div>

            <div style="margin: 2rem 0; text-align: center;">
                <img src="./chainlink-architecture.png" alt="Chainlink Architecture"
                    style="max-width: 100%; border-radius: 12px; border: 1px solid var(--border); box-shadow: var(--shadow-md);">
                <p style="font-size: 0.8125rem; color: var(--text-muted); margin-top: 0.5rem;">Chainlink Decentralized
                    Oracle Network (DON) Architecture</p>
            </div>
        </section>

        <!-- Section 2.2: Handling Long-tail Markets -->
        <section id="long-tail-markets">
            <h3>2.2 Handling Long-tail & Unstructured Markets</h3>
            <p>What if we want to resolve a niche market like <em>"Who won the local 'Our Ballad' singing
                    contest?"</em>?</p>

            <h4>Scenario A: Data Exists Online</h4>
            <div class="box box-highlight">
                <span class="box-title">Solution: Chainlink Functions</span>
                <p>If the result is published on an official website, news article, or Wikipedia:</p>
                <ol>
                    <li><strong>Developer</strong> writes a JavaScript script to scrape the winner's name (e.g., from
                        <code>div.winner</code>).
                    </li>
                    <li><strong>Chainlink Nodes (DON)</strong> execute this script and fetch the data.</li>
                    <li><strong>Consensus</strong> is reached, and the result ("Kim Cheol-soo") is delivered on-chain.
                    </li>
                </ol>
                <p style="color: #166534; font-weight: 500; margin-top: 0.5rem;">‚úì Best for: Verifiable digital data
                    sources.</p>
            </div>

            <h4>Scenario B: No Digital Footprint</h4>
            <div class="box box-danger">
                <span class="box-title">The Limitation</span>
                <p>If the contest is so small that no news covers it and there's no website, <strong>Chainlink cannot
                        resolve it</strong>. Chainlink is a delivery service for real-world data, not a creator of
                    truth.</p>
            </div>

            <h4>Alternative: UMA (Optimistic Oracle)</h4>
            <p>For unstructured, long-tail markets where no API exists, <strong>UMA</strong> offers a human-powered
                solution (used by Polymarket).</p>

            <div class="grid-2">
                <div class="card">
                    <h4>How UMA Works</h4>
                    <ol style="font-size: 0.875rem;">
                        <li><strong>Proposal:</strong> Anyone asserts "Kim Cheol-soo won".</li>
                        <li><strong>Challenge Period:</strong> A window (e.g., 2 hours) opens for disputes.</li>
                        <li><strong>Finalization:</strong> If no dispute, the answer is accepted.</li>
                        <li><strong>Dispute:</strong> If challenged, token holders vote to decide the truth.</li>
                    </ol>
                </div>
                <div class="card">
                    <h4>Pros & Cons</h4>
                    <ul style="font-size: 0.875rem;">
                        <li><span style="color: #166534;">‚úì</span> Works for ANY question humans can verify.</li>
                        <li><span style="color: #166534;">‚úì</span> No API required.</li>
                        <li><span style="color: #991b1b;">‚úó</span> Slower (requires challenge period).</li>
                        <li><span style="color: #991b1b;">‚úó</span> More complex game theory.</li>
                    </ul>
                </div>
            </div>

            <div class="box box-warning">
                <span class="box-title">Summary: Choosing the Right Oracle</span>
                <ul>
                    <li><strong>Website/API exists</strong> ‚Üí <span class="label label-primary">Chainlink
                            Functions</span> (Cleanest, Fastest)</li>
                    <li><strong>No digital info</strong> ‚Üí <span class="label label-warning">UMA (Optimistic)</span> or
                        <span class="label label-danger">Manual Admin</span> (Cheapest)
                    </li>
                </ul>
            </div>
        </section>

        <!-- Section 2.3: Chainlink Products -->
        <section id="chainlink-products">
            <h3>2.3 Chainlink Products Overview</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Use Case</th>
                            <th>Best For</th>
                            <th>Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Data Feeds</strong></td>
                            <td>Price data (BTC, ETH, stocks)</td>
                            <td>"Will BTC exceed $100K?"</td>
                            <td><span class="label label-success">FREE</span></td>
                        </tr>
                        <tr>
                            <td><strong>Functions</strong></td>
                            <td>Custom API calls</td>
                            <td>Sports scores, election results</td>
                            <td>~0.25 LINK/request</td>
                        </tr>
                        <tr>
                            <td><strong>Automation</strong></td>
                            <td>Scheduled/conditional execution</td>
                            <td>Auto-resolve at deadline</td>
                            <td>~0.1 LINK/execution</td>
                        </tr>
                        <tr>
                            <td><strong>VRF</strong></td>
                            <td>Verifiable randomness</td>
                            <td>Lottery-style markets</td>
                            <td>~0.25 LINK/request</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="grid-3">
                <div class="card">
                    <h4>Data Feeds</h4>
                    <p style="font-size: 0.875rem;">Real-time, tamper-proof price data for crypto, commodities, forex.
                    </p>
                    <pre style="font-size: 0.75rem;">Nodes ‚Üí Aggregate ‚Üí On-chain
       ‚Üì
Contract reads price
       ‚Üì
Compare ‚Üí Resolve</pre>
                </div>
                <div class="card">
                    <h4>Functions</h4>
                    <p style="font-size: 0.875rem;">Execute custom JavaScript to fetch from any API.</p>
                    <pre style="font-size: 0.75rem;">Contract ‚Üí Request ‚Üí DON
       ‚Üì
Execute JavaScript
       ‚Üì
Fetch API ‚Üí Return</pre>
                </div>
                <div class="card">
                    <h4>Automation</h4>
                    <p style="font-size: 0.875rem;">Auto-call contract functions on schedule or conditions.</p>
                    <pre style="font-size: 0.75rem;">Register Upkeep ‚Üí Monitor
       ‚Üì
Condition met?
       ‚Üì
performUpkeep()</pre>
                </div>
            </div>
        </section>

        <!-- Section 2.4: Resolution Architecture -->
        <section id="resolution-arch">
            <h3>2.4 Resolution Architecture</h3>

            <h4>Current vs Proposed Flow</h4>
            <div class="grid-2">
                <div class="card">
                    <h4>Current: Admin Resolution</h4>
                    <div class="flow-step">Admin UI</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">POST /api/admin/resolve</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">Server Wallet signs tx</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step final">reportPayouts() ‚Üí Resolved</div>
                    <p style="font-size: 0.8125rem; margin-top: 1rem; color: #991b1b;"><strong>Admin manually decides
                            winner</strong></p>
                </div>
                <div class="card">
                    <h4>Proposed: Chainlink Resolution</h4>
                    <div class="flow-step">Market Deadline</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">Chainlink Automation triggers</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step">Contract reads Price Feed</div>
                    <div class="flow-arrow">‚Üì</div>
                    <div class="flow-step final">reportPayouts() ‚Üí Resolved</div>
                    <p style="font-size: 0.8125rem; margin-top: 1rem; color: #166534;"><strong>Data-driven automatic
                            resolution</strong></p>
                </div>
            </div>
        </section>

        <!-- Section 2.5: Smart Contract Integration -->
        <section id="smart-contracts">
            <h3>2.5 Smart Contract Integration</h3>

            <h4>Price Feed Resolver Example</h4>
            <pre>
<span class="code-comment">// SPDX-License-Identifier: MIT</span>
<span class="code-keyword">pragma solidity</span> ^0.8.19;

<span class="code-keyword">import</span> "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";

<span class="code-keyword">contract</span> PriceFeedResolver {
    AggregatorV3Interface internal priceFeed;
    IConditionalTokens public ctf;

    <span class="code-keyword">struct</span> PriceMarket {
        bytes32 questionId;
        uint256 threshold;      <span class="code-comment">// Price threshold in 8 decimals</span>
        bool resolveAbove;      <span class="code-comment">// true = YES wins if price > threshold</span>
        uint256 deadline;
        bool resolved;
    }

    mapping(bytes32 => PriceMarket) public markets;

    <span class="code-keyword">function</span> resolveMarket(bytes32 questionId) <span class="code-keyword">external</span> {
        PriceMarket storage market = markets[questionId];
        <span class="code-keyword">require</span>(!market.resolved, <span class="code-value">"Already resolved"</span>);
        <span class="code-keyword">require</span>(block.timestamp >= market.deadline, <span class="code-value">"Too early"</span>);

        <span class="code-comment">// Get latest price from Chainlink</span>
        (, int256 price, , , ) = priceFeed.latestRoundData();

        <span class="code-comment">// Determine winner</span>
        bool yesWins = market.resolveAbove
            ? price > int256(market.threshold)
            : price < int256(market.threshold);

        <span class="code-comment">// Report payouts to CTF</span>
        uint256[] memory payouts = new uint256[](2);
        payouts[0] = yesWins ? 1 : 0;  <span class="code-comment">// YES outcome</span>
        payouts[1] = yesWins ? 0 : 1;  <span class="code-comment">// NO outcome</span>

        ctf.reportPayouts(questionId, payouts);
        market.resolved = <span class="code-keyword">true</span>;
    }
}
            </pre>

            <h4>Chainlink Functions Example (JavaScript)</h4>
            <pre>
<span class="code-comment">// This code runs in Chainlink Functions DON</span>
<span class="code-keyword">const</span> apiEndpoint = args[0];  <span class="code-comment">// e.g., "https://api.sportsdata.io/..."</span>
<span class="code-keyword">const</span> jsonPath = args[1];     <span class="code-comment">// e.g., "Games[0].Winner"</span>

<span class="code-keyword">const</span> response = <span class="code-keyword">await</span> Functions.makeHttpRequest({
  url: apiEndpoint,
  headers: { <span class="code-value">"Ocp-Apim-Subscription-Key"</span>: secrets.apiKey }
});

<span class="code-keyword">if</span> (response.error) {
  <span class="code-keyword">throw</span> Error(<span class="code-value">"API request failed"</span>);
}

<span class="code-comment">// Navigate JSON path and return result</span>
<span class="code-keyword">const</span> homeTeamWins = result === <span class="code-value">"HomeTeam"</span> ? 1 : 0;
<span class="code-keyword">return</span> Functions.encodeUint256(homeTeamWins);
            </pre>

            <h4>Network Addresses</h4>
            <div class="grid-2">
                <div class="card">
                    <h4>BSC Testnet</h4>
                    <pre style="font-size: 0.75rem;">LINK: 0x84b9B910527Ad5C03A9Ca831909E21e236EA7b06
BTC/USD: 0x5741306c21795FdCBb9b265Ea0255F499DFe515C
ETH/USD: 0x143db3CEEfbdfe5631aDD3E50f7614B6ba708BA7
BNB/USD: 0x2514895c72f50D8bd4B4F9b1110F0D6bD2c97526</pre>
                </div>
                <div class="card">
                    <h4>Polygon Amoy</h4>
                    <pre style="font-size: 0.75rem;">Functions Router: 0xC22a79eBA640940ABB6dF0f7982cc119578E11De
BTC/USD: 0xe7656e23fE8077D438aEfbec2fAbDf2D8e070C4f
ETH/USD: 0xF0d50568e3A7e8259E16663972b11910F89BD8e7</pre>
                </div>
            </div>
        </section>

        <!-- Section 2.6: Cost & Security -->
        <section id="cost-security">
            <h3>2.6 Cost & Security Considerations</h3>

            <h4>Monthly Cost Estimation (100 markets)</h4>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Cost per Use</th>
                            <th>Monthly (100 markets)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Data Feeds (read)</td>
                            <td><span class="label label-success">FREE</span></td>
                            <td>$0</td>
                        </tr>
                        <tr>
                            <td>Functions Request</td>
                            <td>~0.25 LINK</td>
                            <td>25 LINK (~$250)</td>
                        </tr>
                        <tr>
                            <td>Automation Check</td>
                            <td>~0.01 LINK</td>
                            <td>30 LINK (~$300)</td>
                        </tr>
                        <tr>
                            <td>Automation Execute</td>
                            <td>~0.1 LINK</td>
                            <td>10 LINK (~$100)</td>
                        </tr>
                        <tr>
                            <td><strong>Total</strong></td>
                            <td></td>
                            <td><strong>~65 LINK (~$650)</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4>Security Considerations</h4>
            <div class="grid-2">
                <div class="card">
                    <h4>Trust Assumptions</h4>
                    <ul style="font-size: 0.875rem;">
                        <li><strong>Data Feeds:</strong> High trust (decentralized nodes)</li>
                        <li><strong>Functions:</strong> Medium (relies on API)</li>
                        <li><strong>API Sources:</strong> Varies by provider</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Required Checks</h4>
                    <ul style="font-size: 0.875rem;">
                        <li>Validate Chainlink response data</li>
                        <li>Handle Functions errors gracefully</li>
                        <li>Implement fallback to manual</li>
                        <li>Set appropriate gas limits</li>
                        <li>Monitor subscription balances</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Section 2.7: Implementation Roadmap -->
        <section id="roadmap">
            <h3>2.7 Implementation Roadmap</h3>

            <div class="grid-2">
                <div class="card">
                    <h4>Phase 1: Price Feed Markets (Week 1-2)</h4>
                    <ul style="font-size: 0.875rem;">
                        <li>Deploy PriceFeedResolver contract</li>
                        <li>Test with BTC/USD, ETH/USD feeds</li>
                        <li>Create "Will BTC exceed $X?" market</li>
                        <li>Update frontend resolution page</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Phase 2: Automation (Week 3)</h4>
                    <ul style="font-size: 0.875rem;">
                        <li>Add AutomationCompatible to resolver</li>
                        <li>Register Upkeep on Chainlink</li>
                        <li>Test auto-resolution at deadline</li>
                        <li>Monitor and tune gas settings</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Phase 3: Functions (Week 4-5)</h4>
                    <ul style="font-size: 0.875rem;">
                        <li>Set up Functions subscription</li>
                        <li>Deploy FunctionsResolver contract</li>
                        <li>Write JavaScript for sports API</li>
                        <li>Handle edge cases (API down)</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Phase 4: Production (Week 6)</h4>
                    <ul style="font-size: 0.875rem;">
                        <li>Security audit</li>
                        <li>Mainnet deployment</li>
                        <li>Monitoring dashboards</li>
                        <li>Admin fallback procedures</li>
                    </ul>
                </div>
            </div>

            <div class="box box-highlight" style="margin-top: 2rem;">
                <span class="box-title">Summary</span>
                <div class="table-wrapper" style="margin-top: 1rem;">
                    <table>
                        <thead>
                            <tr>
                                <th>Market Type</th>
                                <th>Chainlink Product</th>
                                <th>Cost</th>
                                <th>Complexity</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Price-based ("Will BTC > $X?")</td>
                                <td>Data Feeds</td>
                                <td><span class="label label-success">FREE</span></td>
                                <td>Low</td>
                            </tr>
                            <tr>
                                <td>Time-based auto-resolve</td>
                                <td>Automation</td>
                                <td>~$1/month</td>
                                <td>Medium</td>
                            </tr>
                            <tr>
                                <td>Event-based (sports, elections)</td>
                                <td>Functions</td>
                                <td>~$2.50/request</td>
                                <td>High</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p style="margin-top: 1rem;"><strong>Recommendation:</strong> Start with Price Feed markets (free,
                    simple), add Automation for auto-resolve, then expand to Functions as needed.</p>
            </div>
        </section>

        <footer>
            <p>Nostra Technical Whitepaper | Version 1.0 | December 2025</p>
        </footer>
    </div>
</body>

</html>